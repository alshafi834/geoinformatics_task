import requests
from bs4 import BeautifulSoup
from shapely.geometry import Polygon
import geopandas as gpd
import os
import csv






%load_ext sql
%sql postgresql://env_master:M123xyz@localhost/groundwater

base_url = r"https://howis.eglv.de/pegel/html/stammdaten_html/MO_StammdatenPegel.php?PIDVal="


with open('output.csv', mode='w', newline='') as file:
    writer = csv.writer(file)
    
    # Define the column headers
    column_headers = ['URL_param_no', 'Pegelnummer', 'Gewässer', 'Flusskilometer (km)', 'Pegelnullpunkt (m+NN)', 'Einzugsgebiet (km²)', 'Rechtswert (Gauss-Krüger)', 'Hochwert (Gauss-Krüger)', 'MHW', 'MW', 'MNW']
    
    # Write the column headers to the CSV file
    writer.writerow(column_headers)
    
    for i in range(1, 93):
        url = base_url + str(i)
        
        response = requests.get(url)
        soup = BeautifulSoup(response.content, 'html.parser')
        td_tags = soup.find_all('td')
        td_texts = [td.text.strip() for td in td_tags]
        td_texts.insert(0, i)
        selected_td_texts = [td_texts[i] for i in [0, 3, 5, 7, 9, 11, 13, 15, 18, 21, 24]]
        selected_td_texts = [val if val not in ("", "-") else None for val in selected_td_texts]
        
        var1 = selected_td_texts[0]
        var2 = selected_td_texts[1]
        var3 = selected_td_texts[2]
        var4 = selected_td_texts[3]
        var5 = selected_td_texts[4]
        var6 = selected_td_texts[5]
        var7 = selected_td_texts[6]
        var8 = selected_td_texts[7]
        var9 = selected_td_texts[8]
        var10 = selected_td_texts[9]
        var11 = selected_td_texts[10]
        
        if selected_td_texts[1] is not None:
            print(selected_td_texts)
            # cur.execute("INSERT INTO Masterdata (urlparamid, pegelnummer, gewasser, flusskilometer, pegelnullpunkt, einzugsgebiet, rechtswert, hochwert, mhw, mw, mnw) VALUES (%s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s)", selected_td_texts)
            %sql INSERT INTO "Masterdata" (urlparamid, pegelnummer, gewasser, flusskilometer, pegelnullpunkt, einzugsgebiet, rechtswert, hochwert, mhw, mw, mnw) VALUES (:var1, :var2, :var3, :var4, :var5, :var6, :var7, :var8, :var9, :var10, :var11)
            writer.writerow(selected_td_texts)
    
    








import csv
import requests
from bs4 import BeautifulSoup
from datetime import datetime

url = 'https://howis.eglv.de/pegel/html/uebersicht_internet.php'
response = requests.get(url)
soup = BeautifulSoup(response.content, 'html.parser')

tooltip_divs = soup.select('div.tooltip')
tooltip_heads = []

for div in tooltip_divs:
    tooltip_head = div.select_one('.tooltip-head').text.replace('\n', '')
    tooltip_head_data = [tooltip_head, datetime.now().strftime('%Y-%m-%d %H:%M:%S')]
    tooltip_values = div.select('td.tooltip-value')
    for value in tooltip_values:
        tooltip_head_data.append(value.text.replace('\xa0', ''))
    tooltip_heads.append(tooltip_head_data)

# Write the data to a CSV file
with open('periodic_data.csv', 'w', newline='') as csvfile:
    writer = csv.writer(csvfile)
    writer.writerow(['Place', 'Timestamp', 'Water level', 'discharge'])
    for item in tooltip_heads:
        writer.writerow(item)






engine = sqlalchemy.create_engine("postgresql://env_master:M123xyz@localhost/groundwater")
engine



engine.connect()


%load_ext sql


%sql postgresql://env_master:M123xyz@localhost/groundwater
%sql select * from "Masterdata"
